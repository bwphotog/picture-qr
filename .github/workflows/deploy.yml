name: Deploy to Render

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  DATABASE_URL: ${{ secrets.DATABASE_URL }}

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v3

      - name: 🐍 Set up PostgreSQL Client
        run: sudo apt-get update && sudo apt-get install -y postgresql-client

      - name: 🏗️ Run DB Init Script
        run: |
          chmod +x init_db.sh
          ./init_db.sh

      # เพิ่มขั้นตอน Build/Deploy ถ้าต้องการ
      - name: 🚀 Deploy Backend (optional)
        run: |
          cd backend
          npm install
          # npm run build (ถ้ามี)
          echo "✅ Backend deploy script here"

      - name: 🌐 Deploy Frontend (optional)
        run: |
          cd frontend
          npm install
          # npm run build && deploy
          echo "✅ Frontend deploy script here"
